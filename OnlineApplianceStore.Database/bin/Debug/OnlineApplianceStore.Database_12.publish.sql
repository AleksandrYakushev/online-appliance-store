/*
Deployment script for OnlineApplianceStore

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "OnlineApplianceStore"
:setvar DefaultFilePrefix "OnlineApplianceStore"
:setvar DefaultDataPath "D:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\"
:setvar DefaultLogPath "D:\Program Files\Microsoft SQL Server\MSSQL14.MSSQLSERVER\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Dropping [dbo].[Order_fk0]...';


GO
ALTER TABLE [dbo].[Order] DROP CONSTRAINT [Order_fk0];


GO
PRINT N'Dropping [dbo].[OrderProduct_fk0]...';


GO
ALTER TABLE [dbo].[OrderProduct] DROP CONSTRAINT [OrderProduct_fk0];


GO
PRINT N'Dropping [dbo].[OrderProduct_fk1]...';


GO
ALTER TABLE [dbo].[OrderProduct] DROP CONSTRAINT [OrderProduct_fk1];


GO
PRINT N'Dropping [dbo].[ProductStorage_fk0]...';


GO
ALTER TABLE [dbo].[ProductStorage] DROP CONSTRAINT [ProductStorage_fk0];


GO
PRINT N'Dropping [dbo].[ProductStorage_fk1]...';


GO
ALTER TABLE [dbo].[ProductStorage] DROP CONSTRAINT [ProductStorage_fk1];


GO
PRINT N'Starting rebuilding table [dbo].[Customer]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Customer] (
    [Id]             BIGINT         IDENTITY (1, 1) NOT NULL,
    [RoleId]         INT            NOT NULL,
    [Phone]          BIGINT         NOT NULL,
    [Name]           NVARCHAR (20)  NULL,
    [LastName]       NVARCHAR (20)  NULL,
    [Address]        NVARCHAR (100) NULL,
    [Email]          NVARCHAR (50)  NULL,
    [Birthday]       DATE           NULL,
    [FirstOrderDate] DATETIME2 (7)  NULL,
    [LastOrderDate]  DATETIME2 (7)  NULL,
    [IsDeleted]      BIT            NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_CUSTOMER1] PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Customer])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Customer] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Customer] ([Id], [RoleId], [Phone], [Name], [LastName], [Address], [Email], [Birthday], [FirstOrderDate], [LastOrderDate], [IsDeleted])
        SELECT   [Id],
                 [RoleId],
                 [Phone],
                 [Name],
                 [LastName],
                 [Address],
                 [Email],
                 [Birthday],
                 [FirstOrderDate],
                 [LastOrderDate],
                 [IsDeleted]
        FROM     [dbo].[Customer]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Customer] OFF;
    END

DROP TABLE [dbo].[Customer];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Customer]', N'Customer';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_CUSTOMER1]', N'PK_CUSTOMER', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[Order]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Order] (
    [Id]         BIGINT IDENTITY (1, 1) NOT NULL,
    [ProductId]  BIGINT NOT NULL,
    [CustomerId] BIGINT NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_ORDER1] PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Order])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Order] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Order] ([Id], [ProductId], [CustomerId])
        SELECT   [Id],
                 [ProductId],
                 [CustomerId]
        FROM     [dbo].[Order]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Order] OFF;
    END

DROP TABLE [dbo].[Order];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Order]', N'Order';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_ORDER1]', N'PK_ORDER', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[OrderProduct]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_OrderProduct] (
    [Id]            BIGINT IDENTITY (1, 1) NOT NULL,
    [OrderId]       BIGINT NOT NULL,
    [ProductId]     BIGINT NOT NULL,
    [ProductAmount] INT    NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_ORDERPRODUCT1] PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[OrderProduct])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_OrderProduct] ON;
        INSERT INTO [dbo].[tmp_ms_xx_OrderProduct] ([Id], [OrderId], [ProductId], [ProductAmount])
        SELECT   [Id],
                 [OrderId],
                 [ProductId],
                 [ProductAmount]
        FROM     [dbo].[OrderProduct]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_OrderProduct] OFF;
    END

DROP TABLE [dbo].[OrderProduct];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_OrderProduct]', N'OrderProduct';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_ORDERPRODUCT1]', N'PK_ORDERPRODUCT', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[Product]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Product] (
    [Id]               BIGINT        IDENTITY (1, 1) NOT NULL,
    [Name]             NVARCHAR (1)  NOT NULL,
    [Price]            DECIMAL (18)  NOT NULL,
    [Length]           FLOAT (53)    NOT NULL,
    [Width]            FLOAT (53)    NOT NULL,
    [Height]           FLOAT (53)    NOT NULL,
    [Weight]           FLOAT (53)    NOT NULL,
    [Manufacturer]     NVARCHAR (50) NOT NULL,
    [ProductionYear]   DATE          NOT NULL,
    [MaxPower]         FLOAT (53)    NOT NULL,
    [NumberOfPrograms] INT           NULL,
    [Color]            NVARCHAR (20) NULL,
    [BowlVolume]       FLOAT (53)    NULL,
    [ProductShape]     NVARCHAR (20) NULL,
    [ProductLife]      INT           NULL,
    [NoiseLevel]       INT           NULL,
    [MinTemperature]   INT           NULL,
    [NumberOfToasts]   INT           NULL,
    [BatteryLife]      INT           NULL,
    [PowerRegulator]   BIT           NULL,
    [Timer]            BIT           NULL,
    [Defrost]          BIT           NULL,
    [SuperFrost]       BIT           NULL,
    [Backlight]        BIT           NULL,
    [Display]          BIT           NULL,
    [CarboneFilter]    BIT           NULL,
    [WetCleaning]      BIT           NULL,
    [GlassCase]        BIT           NULL,
    [RemoteController] BIT           NULL,
    [WithBattery]      BIT           NULL
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Product])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Product] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Product] ([Id], [Name], [Price], [Length], [Width], [Height], [Weight], [Manufacturer], [ProductionYear], [MaxPower], [NumberOfPrograms], [Color], [BowlVolume], [ProductShape], [ProductLife], [NoiseLevel], [MinTemperature], [NumberOfToasts], [BatteryLife], [PowerRegulator], [Timer], [Defrost], [SuperFrost], [Backlight], [Display], [CarboneFilter], [WetCleaning], [GlassCase], [RemoteController], [WithBattery])
        SELECT [Id],
               [Name],
               [Price],
               [Length],
               [Width],
               [Height],
               [Weight],
               [Manufacturer],
               [ProductionYear],
               [MaxPower],
               [NumberOfPrograms],
               [Color],
               [BowlVolume],
               [ProductShape],
               [ProductLife],
               [NoiseLevel],
               [MinTemperature],
               [NumberOfToasts],
               [BatteryLife],
               [PowerRegulator],
               [Timer],
               [Defrost],
               [SuperFrost],
               [Backlight],
               [Display],
               [CarboneFilter],
               [WetCleaning],
               [GlassCase],
               [RemoteController],
               [WithBattery]
        FROM   [dbo].[Product];
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Product] OFF;
    END

DROP TABLE [dbo].[Product];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Product]', N'Product';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[ProductStorage]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_ProductStorage] (
    [Id]           BIGINT IDENTITY (1, 1) NOT NULL,
    [ProductId]    BIGINT NOT NULL,
    [StorageId]    INT    NOT NULL,
    [ProductCount] INT    NOT NULL,
    CONSTRAINT [tmp_ms_xx_constraint_PK_PRODUCTSTORAGE1] PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[ProductStorage])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_ProductStorage] ON;
        INSERT INTO [dbo].[tmp_ms_xx_ProductStorage] ([Id], [ProductId], [StorageId], [ProductCount])
        SELECT   [Id],
                 [ProductId],
                 [StorageId],
                 [ProductCount]
        FROM     [dbo].[ProductStorage]
        ORDER BY [Id] ASC;
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_ProductStorage] OFF;
    END

DROP TABLE [dbo].[ProductStorage];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_ProductStorage]', N'ProductStorage';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_PK_PRODUCTSTORAGE1]', N'PK_PRODUCTSTORAGE', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[Role]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Role] (
    [Id]   INT           IDENTITY (1, 1) NOT NULL,
    [Name] NVARCHAR (20) NOT NULL,
    UNIQUE NONCLUSTERED ([Name] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Role])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Role] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Role] ([Id], [Name])
        SELECT [Id],
               [Name]
        FROM   [dbo].[Role];
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Role] OFF;
    END

DROP TABLE [dbo].[Role];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Role]', N'Role';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[Storage]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Storage] (
    [Id]   INT           IDENTITY (1, 1) NOT NULL,
    [Name] NVARCHAR (20) NOT NULL,
    UNIQUE NONCLUSTERED ([Name] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Storage])
    BEGIN
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Storage] ON;
        INSERT INTO [dbo].[tmp_ms_xx_Storage] ([Id], [Name])
        SELECT [Id],
               [Name]
        FROM   [dbo].[Storage];
        SET IDENTITY_INSERT [dbo].[tmp_ms_xx_Storage] OFF;
    END

DROP TABLE [dbo].[Storage];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Storage]', N'Storage';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Refreshing [dbo].[DeleteCustomerById]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[DeleteCustomerById]';


GO
PRINT N'Update complete.';


GO
